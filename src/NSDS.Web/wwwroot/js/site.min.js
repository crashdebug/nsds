var app=angular.module("nsds",[]);app.config(["$compileProvider",function(e){e.debugInfoEnabled(!1)}]),app.controller("DeploymentController",function(e,n){e.selectedItems=[],e.canDeploy=!1,e.deploy=function(){var e=_.groupBy(this.selectedItems,function(e){return e.module.module.name});for(var t in e){var o=[],l=_.map(e[t],function(e){e.module.isDeploying=!0,e.module.selected=!1;var n=document.getElementById(e.module.$$hashKey.replace(":","_")),t=new Spinner({lines:9,length:3,width:3,radius:5,scale:1,corners:1,color:"#ccc",opacity:.05,rotate:0,direction:1,speed:.7,trail:75,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"relative"}).spin(n);return o.push({spinner:t,client:e.client,module:e.module}),e.client.name});n.post("api/deploy/module/"+t,l).then(function(e){_.each(o,function(n){n.spinner.stop(),n.module.isDeploying=!1;var t=_.find(e.data,function(e){return e.result.client.name==n.client.name&&e.result.module.name==n.module.module.name}).result;n.module.isLatest=t.version.isLatest,n.module.version=t.version.version})},function(e){_.each(o,function(e){e.spinner.stop(),e.module.isDeploying=!1})})}this.selectedItems=[]}}),app.controller("PoolsController",function(e,n){n.get("api/pools").then(function(n){e.pools=n.data})}),app.controller("ClientsController",function(e,n){n.get("api/clients/").then(function(n){e.pools=_.groupBy(n.data,function(e){return e.poolId}),e.clients=_.each(n.data,function(n){_.each(n.modules,function(t){t.selected=!1,t.isDeploying=!1,t.select=function(){t.isDeploying||(t.selected=!t.selected,t.selected?e.$parent.$parent.selectedItems.push({client:n,module:t}):e.$parent.$parent.selectedItems=_.reject(e.$parent.selectedItems,function(e){return e.client==n&&e.module==t}),e.$parent.$parent.canDeploy=e.$parent.$parent.selectedItems.length>0)}}),n.select=function(){for(var e=0;this.modules&&e<this.modules.length;e++)this.modules[e].isLatest||(this.modules[e].selected=!0)},n.selected=function(){return _.some(n.modules,function(e){return e.selected})},n.status=function(){return _.find(n.modules,function(e){return e.isDeploying})?"deploying":_.find(n.modules,function(e){return!e.isLatest})?"warn":"ok"}})})}),app.controller("PackagesController",function(e,n){e.deploy=function(e){e.isDeploying=!0;var t=document.getElementById(e.$$hashKey.replace(":","_")),o=new Spinner({lines:9,length:5,width:3,radius:5,scale:1,corners:1,color:"#ccc",opacity:.05,rotate:0,direction:1,speed:.7,trail:75,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!1,position:"relative"}).spin(t);n.get("/api/deploy/package/"+e.name).then(function(n){e.isDeploying=!1,o.stop()},function(n){e.isDeploying=!1,o.stop()})},n.get("api/packages").then(function(n){e.packages=_.each(n.data,function(e){e.isDeploying=!1},function(e){x.isDeploying=!1})})});